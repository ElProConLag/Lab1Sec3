\documentclass[letter,12pt]{article}
\usepackage[paperheight=27.94cm,paperwidth=21.59cm,bindingoffset=0in,left=3cm,right=2.0cm, top=3.5cm,bottom=2.5cm, headheight=200pt, headsep=1.0\baselineskip]{geometry}
\usepackage{graphicx,lastpage}
\usepackage{upgreek}
\usepackage{censor}
\usepackage[spanish,es-tabla]{babel}
\usepackage{pdfpages}
\usepackage{tabularx}
\usepackage{adjustbox}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{rotating}
\usepackage{multirow}
\usepackage[utf8]{inputenc}
\usepackage{float}
\usepackage{enumitem}

\renewcommand{\tablename}{Tabla}
\setlist{itemsep=5pt}
\usepackage{fancyhdr}
\pagestyle{fancy}


%
\begin{document}
%
   \title{\Huge{Informe Laboratorio 1}}

   \author{\textbf{Sección 4} \\  \\Camilo Rojas \\ e-mail: camilo.pinto1@mail.udp.cl}
          
   \date{Septiembre de 2025}

   \maketitle
   
   \tableofcontents
 
  \newpage
  

\section{Descripción}

\begin{enumerate}
    \item  Usted empieza a trabajar en una empresa tecnológica que se jacta de poseer sistemas que permiten identificar filtraciones de información a través de Deep Packet Inspection (DPI).
    A usted le han encomendado auditar si efectivamente estos sistemas son capaces de detectar las filtraciones a través de tráfico de red. Debido a que el programa ping es ampliamente utilizado desde dentro y hacia fuera de la empresa, su tarea será crear un software que permita replicar tráfico generado por el programa ping con su configuración por defecto, pero con fragmentos de información confidencial. Recuerde que al comparar tráfico real con el generado no debe gatillar alarmas.
    De todas formas, deberá hacer una prueba de concepto, en la cual se demuestre que al conocer el algoritmo, será fácil determinar el mensaje en claro.
    Para los pasos 1,2,3 indicar el texto entregado a IA Generativa y validar si el código resultante cumple con lo requerido.
\end{enumerate}


\section{Actividades}


\subsection{Algoritmo de cifrado}

\begin{enumerate}
\item Generar un programa, en python3 utilizando IA Generativa, que permita cifrar texto utilizando el algoritmo Cesar. Como parámetros de su programa deberá ingresar el string a cifrar y luego el desplazamiento.

\begin{figure}[H]
        \centering
        \includegraphics[width=15cm]{actividades/A1.png}
        \label{fig:a1}
\end{figure}

\end{enumerate}

\subsection{Modo stealth}

\begin{enumerate}
    \item Generar un programa, en python3 utilizando IA Generativa, que permita enviar los caracteres del string (el del paso 1) en varios paquetes ICMP request (un caracter por paquete en el campo data de ICMP) para de esta forma no gatillar sospechas sobre la filtración de datos.

Deberá mostrar los campos de un ping real previo y posterior al suyo y demostrar que su tráfico consideró todos los aspectos para pasar desapercibido.

    \begin{figure}[H]
        \centering
        \includegraphics[width=15cm]{actividades/A2.1.png}
        \label{fig:a2-1}
    \end{figure}
    
    El último carácter del mensaje se transmite como una b.
    
    \begin{figure}[H]
            \centering
            \includegraphics[width=15cm]{actividades/A2.2.png}
            \label{fig:a2-2}
        \end{figure}
\end{enumerate}

\subsection{MitM}
\begin{enumerate}
    \item Generar un programa, en python3 utilizando IA Generativa, que permita obtener el mensaje transmitido en el paso2. Como no se sabe cual es el desplazamiento utilizado, genere todas las combinaciones posibles e imprímalas, indicando en verde la opción más probable de ser el mensaje en claro.
    
    \begin{figure}[H]
        \centering
        \includegraphics[width=12cm]{actividades/A3.png}
        \label{fig:a3}
    \end{figure}
    
    Finalmente, deberá indicar por que eligió esa IA Generativa en relación a otras del mercado. Comente si tuvo algún problema al momento de generar los códigos.

\end{enumerate}

\section{Desarrollo de Actividades}
En este informe se adjunta solo una parte de las instrucciones entregadas a IA Generativa (incluyendo Figuras \ref{github1} y \ref{github2}), debido al uso de un agente con tiempo de 'pensamiento' extendido y en acceso anticipado.

Los prompts completos están disponibles en https://github.com/ElProConLag/Lab1Sec3/pulls

Los programas creados para este laboratorio fueron probados en los siguientes entornos:
\begin{itemize}
    \item Fedora Silverblue 42
    \item GitHub Codespace basado en Ubuntu 24.04
\end{itemize}
El código fuente está disponible en https://github.com/ElProConLag/Lab1Sec3
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 23-29-08.png}
    \caption{Listado de Pull Requests iniciadas desde agentes de GitHub Copilot}
    \label{github1}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 23-30-21.png}
    \caption{Primera solicitud a GitHub Copilot}
    \label{github2}
\end{figure}
\subsection{Actividad 1: Implementación del Algoritmo de Cifrado César}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 23-00-32.png}
    \caption{Salida de terminal del primer programa llamado desde demo.py}
    \label{terminal1}
\end{figure}
Para la primera actividad se desarrolló un programa en Python3 que implementa el algoritmo de cifrado César. El desarrollo se realizó utilizando herramientas de IA Generativa, específicamente GitHub Copilot, para acelerar el proceso de codificación y asegurar mejores prácticas.

\textbf{Prompt principal utilizado para IA Generativa:}
\begin{quote}
"Crear un programa en Python3 que implemente el cifrado César. El programa debe aceptar como parámetros el texto a cifrar y el valor de desplazamiento. Debe manejar letras mayúsculas y minúsculas, preservar caracteres especiales y espacios. Incluir funcionalidad para descifrado y análisis automático de texto cifrado."
\end{quote}

\textbf{Características implementadas:}
\begin{itemize}
    \item Cifrado César con desplazamiento configurable (0-25).
    \item Preservación de caracteres no alfabéticos (espacios, puntuación, números).
    \item Soporte para caracteres Unicode.
    \item Modo de análisis automático que prueba todos los desplazamientos posibles.
    \item Detección inteligente de idioma (español e inglés) basada en:
    \begin{itemize}
        \item Diccionarios de palabras comunes.
        \item Análisis de patrones de letras característicos.
        \item Proporción de vocales y consonantes.
        \item Frecuencia de letras específicas del idioma.
    \end{itemize}
\end{itemize}

\textbf{Ejemplo de ejecución:} En la Figura \ref{terminal1} se observa como la palabra 'secret' cambia al desplazar en siete cada carácter.

El programa cumple con los requisitos, permitiendo el cifrado en César manteniendo la longitud y manteniendo fijo el desplazamiento.

\subsection{Actividad 2: Implementación del Modo Stealth mediante ICMP}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 22-35-30.png}
    \caption{Salida del comando ping y del programa Stealth en terminal}
    \label{fig:terminal2}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 22-28-32.png}
    \caption{Captura de pantalla de Wireshark (lista y descripción)}
    \label{fig:wireshark}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 22-50-18.png}
    \caption{Captura de pantalla de Wireshark (datos en hexadecimal y texto plano)}
    \label{fig:hex-plano}
\end{figure}
La segunda actividad consistió en desarrollar un programa que permite la transmisión encubierta de datos cifrados a través de paquetes ICMP, simulando tráfico normal de ping para evadir sistemas DPI.

\textbf{Prompt principal utilizado para IA Generativa:}
\begin{quote}
"Crear un programa en Python3 que envíe datos cifrados a través de paquetes ICMP Echo Request, colocando un carácter por paquete en el campo de datos. El tráfico debe ser indistinguible del ping normal para evadir Deep Packet Inspection. Incluir soporte para UTF-8 y caracteres Unicode."
\end{quote}

\textbf{Técnicas de evasión DPI implementadas:}
\begin{itemize}
    \item \textbf{Imitación de protocolo:} Estructura ICMP idéntica al ping estándar.
    \item \textbf{Temporización normal:} Intervalos de un segundo entre paquetes.
    \item \textbf{Tamaño estándar:} Payload de 32 bytes como ping predeterminado.
    \item \textbf{Identificadores legítimos:} Uso del PID como identificador de paquete.
    \item \textbf{Secuenciación normal:} Numeración secuencial de paquetes.
    \item \textbf{Patrón de datos estándar:} Solo el primer byte contiene datos útiles.
\end{itemize}

\textbf{Soporte Unicode:}
El programa maneja caracteres Unicode codificándolos en UTF-8 y enviando cada byte en un paquete separado, permitiendo la transmisión de texto en cualquier idioma.

\textbf{Ejemplo de transmisión:} en la Figura \ref{fig:terminal2} se observa el registro de la comunicación uno a uno de la palabra ingresada como argumento. El número de secuencia aumenta de forma incremental, al igual que el comando ping, además de enviar un carácter 'b' al finalizar. Aunque se usó una palabra conocida para esta actividad, cualquier combinación de caracteres ASCII funciona para su envío mediante ICMP.

La implementación demuestra cómo los atacantes pueden exfiltrar datos ocultándolos en tráfico de red aparentemente legítimo.

Para comprobar que los mensajes ping pueden pasar desapercibidos, usamos software como Wireshark para comparar los paquetes ICMP.

En la Figura \ref{fig:wireshark} se observan dos pings normales y otros nueve mensajes modificados para el envío del mensaje, además de una descripción del primer request modificado.
En la Figura \ref{fig:hex-plano} se observan la representación del payload del paquete mencionado, en hexadecimal y texto plano. El carácter '53' representa la S mayúscula, siendo la primera letra del mensaje enviado.

\subsection{Actividad 3: Implementación del Ataque Man-in-the-Middle}
\begin{figure}
    \centering
    \includegraphics[width=1\linewidth]{actividades/Captura desde 2025-09-04 23-15-50.png}
    \caption{Salida de terminal del último programa, mostrando todos los desplazamientos y el texto plano más probable en inglés}
    \label{fig:terminal3}
\end{figure}
En la tercera actividad se desarrolló un programa capaz de interceptar y decodificar mensajes transmitidos mediante la técnica stealth, simulando un ataque MitM.

\textbf{Prompt principal utilizado para IA Generativa:}
\begin{quote}
"Crear un programa en Python3 que capture paquetes ICMP y extraiga datos ocultos. Debe probar todos los desplazamientos César posibles (0-25) y usar análisis de idioma para identificar el texto plano más probable. Mostrar resultados con código de colores."
\end{quote}

\textbf{Funcionalidades implementadas:}
\begin{itemize}
    \item \textbf{Captura en vivo:} Interceptación de paquetes ICMP usando raw sockets.
    \item \textbf{Reconstrucción de mensajes:} Ensamblado de bytes individuales en texto UTF-8.
    \item \textbf{Análisis por fuerza bruta:} Prueba de los 26 desplazamientos César.
    \item \textbf{Detección inteligente:} Algoritmo de puntuación para identificar texto en inglés y español:
    \begin{itemize}
        \item Reconocimiento de palabras comunes en CTIAM.
        \item Análisis de proporción vocales/consonantes.
        \item Detección de patrones de letras típicos.
        \item Penalización de combinaciones inusuales.
    \end{itemize}
    \item \textbf{Presentación visual:} Resultado más probable resaltado en verde
\end{itemize}

\textbf{Ejemplo de análisis:} En la Figura \ref{fig:terminal3} se observa la captura y descifrado del mensaje generado en la primera actividad, intentando con todos los desplazamientos posibles en el cifrado César, y luego asignando un puntaje según un diccionario predefinido. Al final, se resalta el mensaje en texto plano con mayor probabilidad de ser el original.

El programa demuestra la vulnerabilidad del cifrado César cuando se conoce el método, identificando correctamente el texto plano incluso sin conocer el desplazamiento utilizado.

\section*{Conclusiones y comentarios}

\subsection*{Efectividad de las Técnicas de Evasión DPI}

El laboratorio demostró exitosamente que es posible evadir sistemas de Deep Packet Inspection (DPI) mediante la cuidadosa imitación de protocolos legítimos. Las técnicas implementadas son efectivas porque:

\begin{itemize}
    \item \textbf{Mimetismo de protocolo:} Los paquetes ICMP generados son indistinguibles del tráfico ping normal en estructura, tiempos y tamaño.
    \item \textbf{Fragmentación de datos:} Al enviar solo un byte por paquete, se evita la detección de patrones sospechosos en el payload.
    \item \textbf{Comportamiento normal:} El uso de identificadores legítimos y secuenciación estándar hace que el tráfico pase desapercibido.
\end{itemize}

\subsection*{Implicaciones de Seguridad}

\subsubsection*{Desde la perspectiva del atacante:}
\begin{itemize}
    \item La técnica permite exfiltración de datos lenta pero indetectable.
    \item El soporte Unicode amplía las posibilidades de comunicación encubierta.
    \item La simplicidad del método lo hace accesible incluso para atacantes con conocimientos básicos.
\end{itemize}

\subsubsection*{Desde la perspectiva defensiva:}
\begin{itemize}
    \item Los sistemas DPI tradicionales basados en firmas son insuficientes contra estas técnicas.
    \item Se requiere análisis comportamental y estadístico del tráfico de red.
    \item La monitorización de patrones de ping anómalos puede revelar actividad sospechosa.
\end{itemize}

\subsection*{Limitaciones del Enfoque}

\begin{enumerate}
    \item \textbf{Velocidad de transmisión:} La técnica es extremadamente lenta (1 byte/segundo).
    \item \textbf{Cifrado débil:} El cifrado César es vulnerable a ataques de fuerza bruta.
    \item \textbf{Detección estadística:} Análisis de entropía puede revelar datos no aleatorios.
    \item \textbf{Visibilidad de red:} Patrones de ping inusuales pueden generar sospechas.
\end{enumerate}

\subsection*{Experiencia con IA Generativa}

\subsubsection*{Herramienta utilizadas:} GitHub Copilot Agents (versión preliminar)

\subsubsection*{Ventajas observadas:}
\begin{itemize}
    \item Aceleración significativa del desarrollo.
    \item Sugerencias de mejores prácticas y optimizaciones.
    \item Generación de código limpio y bien documentado.
    \item Asistencia en la implementación de algoritmos complejos.
\end{itemize}

\subsubsection*{Desafíos encontrados:}
\begin{itemize}
    \item Necesidad de validación manual de todo el código generado.
    \item Algunos prompts requerían refinamiento para obtener resultados precisos.
    \item La IA ocasionalmente sugería enfoques menos eficientes que requerían corrección.
    \item Algunos fragmentos de código compartían mucho en común con otros repositorios públicos.
    \item Falta de transparencia al usar modelos cerrados.
\end{itemize}



\subsection*{Contramedidas Recomendadas}

\begin{enumerate}
    \item \textbf{Análisis comportamental:} Monitorear patrones anómalos en tráfico ICMP.
    \item \textbf{Límites de tasa:} Restringir frecuencia de pings por host/usuario.
    \item \textbf{Inspección de entropía:} Detectar datos cifrados mediante análisis estadístico.
    \item \textbf{Segmentación de red:} Limitar tráfico ICMP entre segmentos críticos.
    \item \textbf{Logging avanzado:} Registrar metadatos detallados de paquetes ICMP.
\end{enumerate}

\subsection*{Reflexiones Finales}

Este laboratorio demuestra que la seguridad por oscuridad no es suficiente. Los sistemas deben evolucionar hacia análisis más sofisticados que consideren el comportamiento y contexto del tráfico, no solo patrones de contenido. La facilidad con que se implementaron estas técnicas usando IA Generativa también resalta la necesidad de que los defensores adopten herramientas similares para mantenerse al día con las capacidades de los atacantes.

La combinación de técnicas tradicionales de evasión con herramientas de IA amplifica las capacidades de ciberataque, lo que hace más crucial que nunca la implementación de defensas multicapa y el monitoreo continuo de la red.

\end{document}
